# Alice酱，对进击的Yes酱的亿点小扩展

## 更新

### 更新3 好自闭，又得大改

- 目录修改 放到了同目录删了一些重复的或者不必要文件
- 优化了代码结构
- 配置文件修改
- 将python代码打包成了exe放在发行版中，只是使用无需配置环境，默认使用cpu
- 新增hook-ctypes.macholib.py 在使用pyinstaller打包成exe时用的
  - 命令： pyinstaller -F main.py --additional-hooks-dir=.
  - 结尾有个点
- 删除了start.bat

### 更新2

#### 新功能

- 询问天气

- 询问时间

- 提醒功能
- 新人加入提醒
- 成员退出提醒

#### 修改

- 音乐分享可选分享文件或者分享来自qq、网页、虾米的音乐
- 违规词可选撤回或者禁言60s
- 目录结构
- 除chat之外的python文件部分代码
- 修改了部分bug

### 更新1

首先把我自己训练的模型删除了，换成了

GPT2-chitchat[[yangjianxin1/GPT2-chitchat: GPT2 for Chinese chitchat/用于中文闲聊的GPT2模型(实现了DialoGPT的MMI思想) (github.com)](https://github.com/yangjianxin1/GPT2-chitchat)]



其他变化太大我重写readme吧



### 参考文档

##### [[yes酱](https://www.jianshu.com/p/66318d7e26cf)] 

##### [[go-cqhttp 帮助中心](https://docs.go-cqhttp.org/)]

#### 因为上传文件大小限制原因data下的model文件夹中的三个无法上传，我会把默认引用的一个放到发行版

其他两个模型文件有需要联系我，不过三个模型没有太大差别



#### 邮箱 Yuki7017@outlook.com

#### QQ 2762018040



## 建议环境python3.7

### v0.8

还有几个bug，但是不影响使用，还想整个生活助理模块

### 功能如下 @Alice并说

#### 注 [ ] 中的内容均为配置文件默认的，可自己修改触发条件

0. 如果是@Alice xxxxhelp触发帮助菜单

1. 私聊调教对话 例如aaa+bbb 那么发送aaa就会返回bbb啦~ 可以发送rmaaa+bbb删除对话哦~

2. @murphy并说‘开启聊天模式’会激活聊天机器人聊天

   @murphy并说‘关闭聊天模式’会关闭聊天机器人聊天

3. 发送这几个内容之一会获得一张涩图 [ ghs,来个涩图,涩图,setu,要涩涩,要色色,涩图来一个 ]
   注：群内涩图和私聊涩图不同 

4. 发送这几个内容之一会返回一句古诗 [ 古诗,来一句 ]

5. 发送这几个内容之一会返回一句舔狗日记 [ 喂,在,做我的狗吧 ]

6. 发送这几个内容之一会返回一张二次元图片 [ 图,来个图片,来点二次元 ]

7. 发送这几个内容之一会返回一张猫猫表情 [ 来张猫猫图,来张猫图,猫图,喵图,maomao,猫猫图,猫 ]

8. 发送这几个内容之一会返回或者分享一首歌 [ 音乐,来首歌,歌 ]

9. 发送这几个内容之一会返回当前时间 [ 现在几点了,几点了,什么时候了 ]

10. 发送 地点+[ 天气怎么样,明天天气怎么样 ] 返回天气

11. 发送 [时间（例：3点10分 或3点 ps:没分也行）]+[提醒我,@我]+[要干啥]到了时间Alice会@你

12. 另外，如果你说了不改说的话会根据管理员的设置撤回消息或者封禁60s



## 项目依赖

websocket

websockets

websocket-client

transformers
torch

应该就这些

## 项目结构

│  .gitignore
│  chat.py			//闲聊实现代码
│  config.json	//chatbot的配置文件
│  config.yml	//go-cqhttp的配置文件
│  go-cqhttp.bat
│  go-cqhttp.exe
│  hook-ctypes.macholib.py	//打包用
│  LICENSE
│  main.py	//入口
│  massage_flide.py	//消息处理
│  readme.md
│
├─data
│  ├─model	//模型文件
│  │  └─model_epoch40_50w
│  │          config.json
│  │          pytorch_model.bin
│  │
│  ├─talk_data	//对话文件
│  │  │  specialQA
│  │  │
│  │  └─__pycache__
│  └─voc //词库
│          vocab.txt
│          vocab2.txt
│
├─logs
│  └─ChatData
├─message	//消息处理
│  │  message_action.py
│  │  talk_to_user.py
│  │  word_detect.py
│  │  __init__.py
│  │
│  └─__pycache__
│          message_action.cpython-37.pyc
│          talk_to_user.cpython-37.pyc
│          word_detect.cpython-37.pyc
│          __init__.cpython-37.pyc
│
└─__pycache__
        chat.cpython-37.pyc
        massage_flide.cpython-37.pyc



### 一些文件介绍        

#### config.json

##### bot_set

- mao_path 猫猫图路径
- hs_pic_path 私聊发送的涩图的路径
- ghs_pic_path 群聊发送涩图的路径
- ban_action 遇到违规词的处理方式 ’撤回‘，’禁言‘
- group_increase_msg 新人加入提醒
- group_decrease_msg 成员退出提醒
- group 参与的群号
- self_qq 自己的qq号
- admin_qq 管理者的qq号，用来执行一些命令，但是我没写执行
- use_model 是否启用闲聊模型 0不用 1启用

##### detect_statement

- get_time 发送列表中的一句回复 时间

- ghs_pic 发送列表中的一句回复 涩图
- mao_pic 发送列表中的一句回复 猫猫 表情
- gu_shi 发送列表中的一句回复 古诗
- get_dog 发送列表中的一句回复 舔狗语录
- api_pic 发送列表中的一句回复 二次元图
- get_weather 发送列表中的一句回复 天气
- get_music 发送列表中的一句回复 音乐
- remind 发送列表中的一句回复 提醒

##### model

- model_path 要使用的模型位置
- log_path 日志目录
- vocab_path 词典位置
- save_ChatData_path 闲聊记录
- no_cuda 是否使用cuda 0使用 1不用
- CUDA_VISIBLE_DEVICES 使用那个显卡["0","1"]这种
- repetition_penalty 重复惩罚参数，若生成的对话重复性较高，可适当提高该参数
- topk 最高k选1
- topp 最高累计率
- max_len 每个utterance的最大长度,超过指定长度则进行截断
- max_history_len dialogue history的最大长度
- temperature 生成的temperature

##### music_set

- music_file_link 0是发送音乐文件 1是发送分享链接
- music_type 分享音乐的来源 ‘qq’是QQ音乐 ‘163’是网易云 ‘xm'是虾米
- music 分享的歌单，内容是音乐id
  - [python+selenium爬取网页云音乐的歌单id - tifaIsMyWife - 博客园 ](https://www.cnblogs.com/L-L-ALICE/p/15864755.html)

##### others_answer

bot实在不知道回复什么了说的



**例，也是默认：**

~~~json
{
	"bot_set": {
		"mao_path":"E:\\murphypic\\mao\\",
		"hs_pic_path":"E:\\murphypic\\hs\\",
		"ghs_pic_path":"E:\\murphypic\\setu\\",
		"ban_words":["科学上网","黑产","翻墙","huangse","@全体成员"],
		"use_model":1,
		"group":[123456789, 123456780],
		"self_qq":"123456789",
		"admin_qq":"",
		"ban_action": "撤回",
		"group_increase_msg":"欢迎加入白给协会，进来记得选一个自己喜欢的id，切记整活第一、游戏第二、输赢狗屁不是",
		"group_decrease_msg":"怎么有人走了啊 QAQ"
	},

	"detect_statement": {
		"get_time": ["现在几点了", "几点了", "什么时候了"],
		"ghs_pic": ["ghs", "来个涩图", "涩图", "setu", "要涩涩", "要色色", "涩图来一个"],
		"mao_pic": ["来张猫猫图", "来张猫图", "猫图", "喵图", "maomao", "猫猫图", "猫"],
		"gu_shi": ["古诗", "来一句"],
		"get_dog": ["喂", "在", "做我的狗吧"],
		"api_pic": ["图", "来个图片", "来点二次元"],
		"get_weather": ["天气怎么样","明天天气怎么样"],
		"get_music": ["音乐", "来首歌", "歌"],
		"remind":["提醒我","@我"]

	},

	"admin_cmd_path":{
		"restart_bat_path":"",
		"kill_bat_path":""
	},


	"model": {
		"model_path":"data/model/model_epoch40_50w",
		"log_path":"logs/interact.log",
		"vocab_path":"data/voc/vocab.txt",
		"save_ChatData_path":"logs/ChatData/",

		"no_cuda":0,
		"CUDA_VISIBLE_DEVICES":"0",
		"repetition_penalty":1.0,
		"topk":8,
		"topp":0,
		"max_len":25,
		"max_history_len":5,
		"temperature":1
	},
	
	"music_set": {
		"music_file_link": 1,
		"music_type": "163",
		"musics": ["432698441", "28832241", "1893501030", "32408597", "1423417557", "1375935067", "1390728547", "1445778794", "27591608", "32408691", "412178663", "1854474192", "412016277", "1888706317", "1500151579", "1811129844", "1444448656", "39224540", "1456715619", "467590969", "39227514", "1445536248", "1470931065", "33599494", "1398059619", "34613417", "507116412", "22762109", "1418766731", "493839746", "1440551529", "27759600", "27849894", "1860262663", "1494812318", "17081024", "1309690573", "28713459", "31356499", "28220107", "1449678888", "525940336", "536623501", "484056472", "1481108240", "1358848433", "863967108", "1456443773", "1449790488", "1474096021", "432509390", "1832945165", "1449790487", "29343309", "41630480", "1375920506", "1332041346", "436016480", "1377261977", "461347998", "466794934", "1357775526", "1374000617", "28713525", "509531185", "26142075", "1357775528", "1807381939", "33410933", "16435049", "4284389", "479850552", "1299889486", "28285910", "413077069", "459925512", "1336969345", "31654464", "498286345", "549941712", "1440571286", "1392974075", "1403318151", "1382838382", "420154391", "1811921555", "494645489", "27969840", "29777813", "27969833", "27969844", "27849889", "4930071", "26584163", "724495", "490182454", "29593561", "32069326", "479764527", "28713534", "524148450", "498134", "420134745", "29794281", "431259256", "545367157", "508775113", "1455851458", "22691884", "1353712081", "444075436", "482636096", "1381706037", "30431342", "34609161", "486194215", "543987451", "571595292", "492722", "435278010", "500412241", "554637552", "422977412", "406475388", "571338279", "4990422", "484249940", "1352810247", "525833755", "432792793", "1807537867", "1412645076", "468490592", "557199195", "1395593102", "1381578834", "1443027637", "554244188", "1445093648", "484365652", "484365655", "1387592437", "316100", "1412559986", "1367329337", "35023412", "41629793", "31421442", "26830207", "469719260", "556748766", "33516495", "34613441", "1354451040", "1484336476", "1325114607", "34586919", "1477758510", "492656383", "550124208", "16232697", "28143956", "543740131", "452986206", "20715685", "514774420", "862099159", "481970939", "28402345", "29829683", "557407036", "1417236632", "488388942", "1365898499", "456185223", "1382359170", "1379619299", "1335529596", "33035577", "1370008169", "22826401", "707720", "1381723556", "1381724376", "428116648", "448596416", "1369742379", "454549729", "1431292823", "21965211", "31654478", "1386460251", "525278524", "468490608", "4940455", "29732995", "26082104", "668479", "505336", "472219448", "29436425", "433018866", "31446780", "26625301", "465921195", "1398663411", "18981964", "1375725396", "29307199", "495550881", "425137440", "27969841", "29777817", "498187", "29307038", "560144", "1318903587", "1416181167", "38592976", "480648424", "1380022214", "409872504", "499117", "482636090", "1350633321", "1350629544", "1369007185", "1441637892", "22782025", "1331563283", "1366594775", "442016694", "676508", "446627347", "1446150700", "426027293", "26118113", "825343", "27542599", "1439180290", "1438209841", "1396162013", "409872508", "34723470", "1367452194", "1346676131", "1430652542", "30352891", "419238086", "409941358", "1428235238", "429460240", "29307195", "500412390", "437909145", "29732992", "584155", "35403523", "28681625", "423228325", "1369798757", "1308818967", "29966565", "19945735", "1416840914", "1295824944", "515223490", "1419095067", "1418352641", "1390592883", "1308819790", "1414425461", "32807699", "1365914380", "1378491298", "1378491296", "426881487", "446935665", "426881480", "1376142151", "36587834", "460043372", "27876224", "1396905934", "441491828", "22826405", "28196038", "471565537", "1345368792", "26116370", "17753288", "1407767447", "36668810", "468176711", "1405709611", "19830032", "1363948882", "416892104", "1404314906", "473602423", "4397135", "17706562", "506520164", "3163120", "19292984", "534542079", "474739191", "862190652", "474932898", "1399076217", "468882985", "517543021", "65536", "35625821", "725619", "546777626", "420513820", "1313107065", "33248099", "1296703792", "560025520", "535251412", "515269424", "491484238", "535377723", "22762103", "544246196", "2872197", "32069280", "28157586", "30051135", "17231554", "1374489910", "26590305", "29561528", "500008446", "1327779252", "28923579", "1309896289", "1297841", "1313107926", "1377508141", "28208212", "26281329", "504916651", "560888018", "543681750", "520408847", "479949593", "33378164", "30780496", "512085302", "413077059", "446247998", "29542751", "537854958", "445450723", "399367218", "1354425063", "1331819951", "36270426", "28442976", "554182439", "1326987219", "28481189", "850775", "423015999", "406475394", "26116000", "453176145", "1345075989", "19542337", "529659114", "4208408", "29497924", "449818741", "443291190", "415086297", "421934564", "579954", "1297091362", "28639182", "434052302", "31654455", "405681663", "514774419", "34923851", "542364335", "1330348068", "438456547", "511503019", "509313159", "29732959", "26095964", "463842649", "450795499", "459831628", "32408263"]

	},
	"others_answer": ["你到底在说甚么呀~", "啊这，俺听8懂", "快来教我两句话吧，例如aaa+bbb", "发送菜单就能获取帮助啦", "呜呜呜，我听不懂啦~", "呵，真是人类难以理解的话语呢", "快来私聊教我说话吧~"]

}
~~~



#### config.yml

> 启动配置文件，只需要将里面的uin改成自己的qq号，建议密码为空，扫码登录，这样不会被风控
>
> > 风控了无法发消息，需要删除device.json、session.token重新登录或者挂机几天
>
> > 建议扫码登录前把cmd框拉大，不然你可能看不到二维码

#### device.json

> 登录设备信息

#### go-cqhttp.bat

> 自动生成的启动go-cqhttp.exe的bat

#### session.token

> 验证信息好像是





## 使用

### release版

在config.yml 的account下的uin添上自己的QQ号

运行go-cqhttp.bat，建议在此刻把cmd全屏

QQ扫码登录

运行main.exe

完成

### 源码

#### pip安装依赖

#### 双击go-cqhttp.exe

![image-20220203015757840](https://gitee.com/october_Wr/picgo/raw/master/image-20220203015757840.png)

![image-20220203015819134](https://gitee.com/october_Wr/picgo/raw/master/image-20220203015819134.png)

确定生成了go-cqhttp 脚本

#### 运行go-cqhttp脚本

![image-20220203015915030](https://gitee.com/october_Wr/picgo/raw/master/image-20220203015915030.png)

选择2

![image-20220203015928431](https://gitee.com/october_Wr/picgo/raw/master/image-20220203015928431.png)

### 修改配置文件

![image-20220203020003018](https://gitee.com/october_Wr/picgo/raw/master/image-20220203020003018.png)

这里就行

#### 修改config.json

参考目录结构中的介绍

#### 执行main.py

![image-20220203020425308](https://gitee.com/october_Wr/picgo/raw/master/image-20220203020425308.png)

![image-20220203020414754](https://gitee.com/october_Wr/picgo/raw/master/image-20220203020414754.png)

就完成了



## 运行实例

### 部分功能测试

![image-20220205203934951](https://gitee.com/october_Wr/picgo/raw/master/image-20220205203934951.png)

![image-20220205203914364](https://gitee.com/october_Wr/picgo/raw/master/image-20220205203914364.png)

![image-20220205203902564](https://gitee.com/october_Wr/picgo/raw/master/image-20220205203902564.png)

![image-20220205203840196](https://gitee.com/october_Wr/picgo/raw/master/image-20220205203840196.png)

![image-20220205203810515](https://gitee.com/october_Wr/picgo/raw/master/image-20220205203810515.png)

![image-20220205203741193](https://gitee.com/october_Wr/picgo/raw/master/image-20220205203741193.png)



### 闲聊模式下的聊天功能，这是加强前的，这次更新又加强了一点

![Screenshot_2022-02-04-20-21-49-81_9d26c6446fd7bb8](https://gitee.com/october_Wr/picgo/raw/master/Screenshot_2022-02-04-20-21-49-81_9d26c6446fd7bb8.jpg)





![Screenshot_2022-02-04-20-21-36-97_9d26c6446fd7bb8](https://gitee.com/october_Wr/picgo/raw/master/Screenshot_2022-02-04-20-21-36-97_9d26c6446fd7bb8.jpg)





![Screenshot_2022-02-04-18-32-46-53_9d26c6446fd7bb8](https://gitee.com/october_Wr/picgo/raw/master/Screenshot_2022-02-04-18-32-46-53_9d26c6446fd7bb8.jpg)





